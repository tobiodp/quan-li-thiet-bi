<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quản lý yêu cầu thiết bị | NNT Software</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" th:href="@{/css/app.css}">
    <style>
        /* Buttons */
        .btn-action { padding: 5px 10px; font-size: 0.8rem; border-radius: 6px; transition: 0.2s; }
        .btn-action:hover { transform: translateY(-1px); box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
    </style>
</head>
<body>

<div class="d-flex" id="wrapper">

    <!-- Sidebar -->
    <div class="border-end" id="sidebar-wrapper">
        <div class="sidebar-heading"><i class="fa-brands fa-nfc-symbol me-2"></i>NNT Software</div>
        <div class="list-group list-group-flush">
            <a href="/dashboardController" class="list-group-item list-group-item-action"><i class="fa-solid fa-house me-2"></i> Dashboard</a>
            <a href="/viewDevices" class="list-group-item list-group-item-action"><i class="fa-solid fa-laptop me-2"></i> Thiết bị</a>
            <a href="/viewEmployees" class="list-group-item list-group-item-action"><i class="fa-solid fa-users me-2"></i> Nhân viên</a>
            <a href="/viewDepartments" class="list-group-item list-group-item-action"><i class="fa-solid fa-building me-2"></i> Phòng ban</a>
            <a href="/viewRequests" class="list-group-item list-group-item-action active d-flex justify-content-between align-items-center">
                <span><i class="fa-solid fa-clipboard-check me-2"></i> Yêu cầu</span>
                <span class="badge bg-danger rounded-pill" th:text="${requestDeviceCount}">3</span>
            </a>
            <a href="/admin/borrowed-devices" class="list-group-item list-group-item-action">
                <i class="fa-solid fa-rotate-left me-2"></i> Thiết bị đang mượn
            </a>
            <a href="/admin/notifications/send" class="list-group-item list-group-item-action">
                <i class="fa-solid fa-bell me-2"></i> Gửi thông báo
            </a>
            <a href="/logout" class="list-group-item list-group-item-action mt-auto border-top border-white-50"><i class="fa-solid fa-right-from-bracket me-2"></i> Đăng xuất</a>
        </div>
    </div>

    <div id="page-content-wrapper">

        <nav class="navbar navbar-expand-lg navbar-light px-4 py-3">
            <div class="d-flex align-items-center">
                <button class="btn btn-light border me-3" id="menu-toggle"><i class="fas fa-bars"></i></button>
                <h4 class="m-0 fw-bold text-secondary">Danh sách yêu cầu mượn</h4>
            </div>
            <div class="ms-auto d-flex align-items-center">
                <div class="dropdown">
                    <a href="#" class="d-flex align-items-center text-decoration-none text-dark dropdown-toggle" id="dropdownUser1" data-bs-toggle="dropdown" aria-expanded="false">
                        <img src="https://ui-avatars.com/api/?name=Admin&background=random" alt="admin" width="32" height="32" class="rounded-circle me-2">
                        <strong>Admin</strong>
                    </a>
                    <ul class="dropdown-menu dropdown-menu-end text-small shadow">
                        <li><a class="dropdown-item" href="/logout">Đăng xuất</a></li>
                    </ul>
                </div>
            </div>
        </nav>

        <div class="container-fluid px-4 py-4">

            <div class="card card-custom">
                <div class="card-header bg-white py-3 border-bottom-0 d-flex justify-content-between align-items-center">
                    <h5 class="mb-0 fw-bold text-primary"><i class="fa-solid fa-list-ul me-2"></i>Yêu cầu đang chờ</h5>
                </div>

                <div class="card-body p-0">

                    <div th:if="${#lists.isEmpty(listRequest)}" class="text-center py-5">
                        <p class="text-muted fw-bold">Hiện không có yêu cầu nào đang chờ duyệt.</p>
                    </div>

                    <div th:unless="${#lists.isEmpty(listRequest)}" class="table-responsive">
                        <table class="table table-hover align-middle mb-0">
                            <thead>
                            <tr>
                                <th class="ps-4">ID</th>
                                <th>Nhân viên</th>
                                <th>Thiết bị</th>
                                <th>Lý do mượn</th>
                                <th>Trạng thái</th>
                                <th class="text-end pe-4">Hành động</th>
                            </tr>
                            </thead>
                            <tbody>
                            <tr th:each="req : ${listRequest}">
                                <td class="ps-4 fw-bold text-muted" th:text="'#' + ${req.id}">#1</td>

                                <td>
                                    <div class="d-flex align-items-center">
                                        <div class="avatar-initial"
                                             th:text="${req.user != null ? #strings.substring(req.user.username,0,1) : '?'}">A</div>
                                        <span class="fw-medium"
                                              th:text="${req.user != null ? req.user.username : 'Unknown'}">Nguyễn Văn A</span>
                                    </div>
                                </td>

                                <td>
                                        <span class="badge bg-info bg-opacity-10 text-info border border-info border-opacity-25"
                                              th:text="${req.deviceType}">Laptop</span>
                                </td>
                                <td class="text-secondary" th:text="${req.description}">Làm dự án</td>

                                <td>
                                        <span class="badge bg-warning text-dark">
                                            <i class="fa-regular fa-clock me-1"></i>Chờ duyệt
                                        </span>
                                </td>

                                <td class="text-end pe-4">
                                    <div class="d-flex justify-content-end gap-2">

                                        <a th:href="@{/admin/request/process/{id}(id=${req.id})}"
                                           class="btn btn-success btn-sm btn-action"
                                           title="Kiểm tra & Bàn giao">
                                            <i class="fa-solid fa-clipboard-check me-1"></i> Kiểm tra
                                        </a>

                                        <form th:action="@{/admin/request/reject}" method="post"
                                              onsubmit="return confirm('Bạn có chắc chắn muốn TỪ CHỐI yêu cầu này?');">
                                            <input type="hidden" name="requestId" th:value="${req.id}">
                                            <button type="submit" class="btn btn-danger btn-sm btn-action" title="Từ chối">
                                                <i class="fa-solid fa-xmark"></i>
                                            </button>
                                        </form>
                                    </div>
                                </td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<script>
    var el = document.getElementById("wrapper");
    var toggleButton = document.getElementById("menu-toggle");

    toggleButton.onclick = function () {
        el.classList.toggle("toggled");
    };
</script>

</body>
</html>